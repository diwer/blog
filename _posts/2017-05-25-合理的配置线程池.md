---
title: 合理的配置线程池
tags: [java,thread,threadPool]
grammar_cjkRuby: true
---

日期:2017-5-25 19:19:45


# 合理的配置线程池

## 线程池三个好处
1. 降低资源消耗

	通过复用已创建的线程，降低频繁的创建和销毁造成的资源消耗 
	
2. 提高响应速度
	
	当任务到达时，任务可以不需要等待线程床架就能立即执行.
	
3. 提高线程的可管理性
	
	线程属于稀缺资源，不能无限的创建，受限于操作系统的限制，单进程能创建的线程有限，创建一定数量的线程会导致操作系统的稳定性下降增加线程间争夺资源可能性容易思索

## 线程池处理任务特点

### 任务的性质
1. cpu密集型任务	
	cpu密集型任务配置尽可能小的线程,如 ==n*cpu+1==
	
2. io密集型任务
	io密集型任务由于线程并不是一直在执行任务，择配置尽可能多的线程，如==n*cpu==
	
3. 所谓混合型
	 混合型的任务，尽量做到拆分，
### 任务优先级安排
任务的优先级决定了任务调度,优先级不同的任务可以使用优先级队列来处理。可以让优先级高的任务先得到执行,跟线程优先级一样既不能出现饥饿现象，也不能贪婪,要合理处理优先级,比如处理一定数量的高优先级任务，则必须处理一些低优先级的任务。
### 任务执行的时间
任务执行的时间有很大的比重影响线程池线程数量，防止造成任务堆积不能及时处理。这里面又涉及的超时 阀的设置，任务的时间长度也有可能是在处理过程中发生死锁等现象，造成无限期的线程占用，要设置合理的超时阀，并做好相关资源的释放。io密集型任务一般都属于任务执行时间长的，所以要增加线程数量防止任务积压的现象。同时要处理时间长和时间短任务的之间的关系，适当的提高短任务执行的优先级
### 任务的依赖性
任务是否依赖其他资源，典型的就是数据库连接，恰好数据库连接也是基于池化的。

最后 java提供的线程池实现常用有两种
一种cacheThreadPool,一种fixThreadPool
cache的能够较好的处理io密集型任务处理，但要注意线程数量的控制，
fixThreadPool一般用来 cpu密集型,要注意任务队里的无线增长，
这两种线程池要注意的问题，很有可能就是任务执行过程中超时，或大规模的访造成

所以必须引出下一个问题
## 线程池的监控

1.**taskCount**：执行任务数量的监控
2.completeTaskCount：执行成功任务数量的监看
3.largessPoolSize:线程池创建过最大线程数的值
	通过这个数据可以知道线程池是否满过，如等于线程池的最大限制，择表示线程池饱和需要作出调整和优化
4.getPoolSize 线程池的线程数量，
	如果线程池不销毁的话，池子里的线程 不会自动销毁，所以这个大小只会增长，

通过扩展线程池进行监控，比如任务的最大执行时间和最小执行时间，以及平均执行时间，设置报警阀值。
	

[^1x]:参考，摘抄，记录http://www.infoq.com/cn/articles/java-threadPool
----

wanheming1991@gmail.com